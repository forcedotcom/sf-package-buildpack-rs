#! /bin/sh
# HEROKU BUILDPACK RELEASE COMMAND
#
# bin/release BUILD_DIR
#
set -eu
set -o pipefail

export PROGRAM_DIR="$(cd "$(dirname "$0")/.." && pwd)"
if [ "`uname`" = "Darwin" ]; then
  export ARCH_NAME="x86_64-darwin"
else
  export ARCH_NAME="x86_64-unknown-linux-musl"
fi

export LIB_DIR="$PROGRAM_DIR/lib/$ARCH_NAME"

if [ ! -f $LIB_DIR/cli ]; then
  wget -O $LIB_DIR/cli https://github.com/forcedotcom/sf-package-buildpack-rs/blob/main/lib/$ARCH_NAME/cli?raw=true
  chmod u+x $LIB_DIR/cli
fi

cat << EOF
---
default_process_types:
  worker: sfdx --version
EOF
